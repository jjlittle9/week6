<html>

<head>
  <title>Week 5 - DnD</title>
  
  <style>
    div#output {
				width: 600px;
				height: 200px;
				background-color: #FFF8E7;
				overflow-y: scroll;
    }
  </style>
</head>

<body>
  <script src="player.js"></script>
  <script src="monsters.js"></script>
  
  <h1>DnD</h1>
  
  <p id="on_page"> </p>
  
  <button id="attack">Attack</button>
  <button id="heal">Drink Potion</button>
  
  <div id="output"></div>
  
  <script>
    var message;
    var text = document.getElementById("on_page");

    var game = {
      user: player,
      monsters: listOfMonsters
    }

    function random(maxNumber) {
      return Math.floor(Math.random() * maxNumber);
    }
    
    var current_enemy_index = random(game.monsters.length);
    var hero = game.user.name;
    
    var current_enemy = game.monsters[current_enemy_index].name;
    var current_enemy_hp = game.monsters[current_enemy_index].hp;
    
    var current_enemy_dmg = game.monsters[current_enemy_index].dmg;
    
    var hero_dmg;
    var current_hero_hp = game.user.hp;

    var attack = document.getElementById("attack");
    attack.addEventListener("click", skirmish, random);

    var heal = document.getElementById("heal");
    heal.addEventListener("click", drink_potion);
    
    function skirmish(attack) {
      hero_dmg =  random(game.user.dmg) + 1

      current_enemy_hp -= hero_dmg;
      current_hero_hp -= current_enemy_dmg;

      if (current_enemy_hp <= 0) {
        pickLoot();
        message = "Congrats you won!";
      } else if (current_hero_hp <= 0) {
        message = "You lose!";
      }
      
      display.hud.call();
    }
    
    function drink_potion(heal) {
      if(game.user.has_potion == true) {
        game.user.has_potion = false;
        current_hero_hp += 10;
      } else {
      alert("You do not have any potions to use.")
      }
      display.hud.call();
    }
    
    function pickLoot() {
        var itemRand = Math.random();

        var findAbleItems = [];
        items.forEach( function(item) {
          console.log("in a loop!", item);

          if(item.chance > itemRand) {
            findAbleItems.push(item);
          }
        });

        if(findAbleItems == 0) {
          console.log("no");
        } else {
          var randItemNumber = Math.floor(Math.random() * findAbleItems.length);
          console.log(findAbleItems[randItemNumber]);
        }
      }

    var display = {
      hud: function() {
        return this.text.innerHTML = current_enemy + "<br>" + "Enemy HP: " + current_enemy_hp + "<br>" + hero +  "<br>" + " HP: " + current_hero_hp;
      }
    }
    
    var outputDiv = document.getElementById("output");
			
    function createOutput(message) {
        outputDiv.innerHTML = "<p>" + message + "</p>" + outputDiv.innerHTML;
    }

  </script>
</body>

</html>